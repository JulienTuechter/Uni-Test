@startuml strategy

' config includes
!include ../../config/macros.iuml
!include ../../config/styles.iuml

' diagram includes
!include ../../GameEngine/packages/common.puml

' class diagram (https://plantuml.com/class-diagram)
$package(bot.strategy) {
    interface BotStrategy <<interface>> {
        + suggestAction(player: BotPlayer): Action
    }

    class NavigationStrategy {
        + suggestAction(player: BotPlayer): Action
        - isCellFinishable(cell: Cell, playerId: int, formCount: int): boolean
        - isCellTakeable(cell: Cell, playerId: int, formCount: int): boolean
        + toString(): String
    }
    BotStrategy <|.. NavigationStrategy

    class SearchStrategy {
        {static} - MAX_SEARCH_DEPTH: int = 5 {readOnly}
        - targetFormId: int {readOnly}
        - searchAttempts: int
        --
        + SearchStrategy(targetFormId: int)
        + suggestAction(player: BotPlayer): Action
        + reset(): void
        - isTargetForm(cell: Cell, playerId: int): boolean
        + toString(): String
    }
    BotStrategy <|.. SearchStrategy

    class KickStrategy {
        + suggestAction(player: BotPlayer): Action
        - isValidKickDestination(targetCell: Cell): boolean
        - hasEnemyForm(cell: Cell, playerId: int): boolean
        + toString(): String
    }
    BotStrategy <|.. KickStrategy

    class AvoidanceStrategy {
        {static} - HISTORY_SIZE: int = 6 {readOnly}
        {static} - FORCE_THRESHOLD: int = 3 {readOnly}
        {static} - MAX_FORCE_STEPS: int = 5 {readOnly}
        {static} - ESCAPE_STEPS: int = 2 {readOnly}
        - blockedCounts: Map<Position, Integer> {readOnly}
        - positionHistory: Deque<Position> {readOnly}
        - forcingMode: boolean
        - forcingSteps: int
        - escapeSteps: int
        --
        + suggestAction(player: BotPlayer): Action
        - updatePositionHistory(position: Position): void
        - handlePingPongEscape(currentDirection: Direction,
        leftCell: Cell, rightCell: Cell): Action
        - continueEscapeIfActive(op: Function<Direction, Cell>): Action
        - findEnemyDirection(op: Function<Direction, Cell>): Direction
        - handleEnemyEncounter(currentPosition: Position,
        currentDirection: Direction, enemyDirection: Direction,
        leftCell: Cell, rightCell: Cell): Action
        - handleForcingMode(currentPosition: Position, enemyDirection: Direction): Action
        - resetForcingMode(currentPosition: Position): void
        - resetEscape(): void
        - trySideStep(currentDirection: Direction,
        leftCell: Cell, rightCell: Cell): Action
        - findViableDirection(leftCell: Cell, left: Direction,
        rightCell: Cell, right: Direction): Direction
        - isViableUnvisited(cell: Cell): boolean
        - isPingPongPattern(): boolean
        - tryEscape(currentDirection: Direction, leftCell: Cell, rightCell: Cell): Action
        - selectEscapeDirection(leftCell: Cell, left: Direction,
        rightCell: Cell, right: Direction): Direction
        - isViable(cell: Cell): boolean
        + toString(): String
    }
    BotStrategy <|.. AvoidanceStrategy
    AvoidanceStrategy --> "1" engine.common.Direction : - escapeDirection: Direction

    class ExplorationStrategy {
        + suggestAction(player: BotPlayer): Action
        + toString(): String
    }
    BotStrategy <|.. ExplorationStrategy

    class BacktrackStrategy {
        + suggestAction(player: BotPlayer): Action
        + toString(): String
    }
    BotStrategy <|.. BacktrackStrategy

    class FallbackStrategy {
        + suggestAction(player: BotPlayer): Action
        + toString(): String
    }
    BotStrategy <|.. FallbackStrategy
}

@enduml
